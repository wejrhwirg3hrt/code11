<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-10 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tachometer-alt me-2"></i>é¡µé¢æ€§èƒ½æµ‹è¯•</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>é¡µé¢åŠ è½½æµ‹è¯•</h5>
                                <div class="mb-3">
                                    <button class="btn btn-primary me-2" onclick="testPageLoad('/stats')">
                                        <i class="fas fa-chart-bar me-1"></i>æµ‹è¯•ç»Ÿè®¡é¡µé¢
                                    </button>
                                    <button class="btn btn-success me-2" onclick="testPageLoad('/achievements')">
                                        <i class="fas fa-trophy me-1"></i>æµ‹è¯•æˆå°±é¡µé¢
                                    </button>
                                    <button class="btn btn-info me-2" onclick="testPageLoad('/profile')">
                                        <i class="fas fa-user me-1"></i>æµ‹è¯•ä¸ªäººèµ„æ–™
                                    </button>
                                </div>
                                
                                <h5>APIå“åº”æµ‹è¯•</h5>
                                <div class="mb-3">
                                    <button class="btn btn-warning me-2" onclick="testAPI('/api/statistics/overview')">
                                        <i class="fas fa-chart-line me-1"></i>ç»Ÿè®¡API
                                    </button>
                                    <button class="btn btn-secondary me-2" onclick="testAPI('/api/user-activity/level')">
                                        <i class="fas fa-level-up-alt me-1"></i>ç­‰çº§API
                                    </button>
                                    <button class="btn btn-dark me-2" onclick="testAPI('/api/achievements/current-user')">
                                        <i class="fas fa-medal me-1"></i>æˆå°±API
                                    </button>
                                </div>
                                
                                <h5>æ‰¹é‡æµ‹è¯•</h5>
                                <div class="mb-3">
                                    <button class="btn btn-danger me-2" onclick="runBatchTest()">
                                        <i class="fas fa-rocket me-1"></i>è¿è¡Œæ‰¹é‡æµ‹è¯•
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="clearResults()">
                                        <i class="fas fa-trash me-1"></i>æ¸…ç©ºç»“æœ
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>æµ‹è¯•ç»“æœ</h5>
                                <div id="testResults" class="border p-3" style="min-height: 400px; background-color: #f8f9fa; font-family: monospace; font-size: 12px; overflow-y: auto;">
                                    ç‚¹å‡»å·¦ä¾§æŒ‰é’®å¼€å§‹æ€§èƒ½æµ‹è¯•...
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row">
                            <div class="col-12">
                                <h5>æ€§èƒ½ç»Ÿè®¡</h5>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="card text-center">
                                            <div class="card-body">
                                                <h6 class="card-title">å¹³å‡å“åº”æ—¶é—´</h6>
                                                <h4 id="avgResponseTime" class="text-primary">-</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card text-center">
                                            <div class="card-body">
                                                <h6 class="card-title">æœ€å¿«å“åº”</h6>
                                                <h4 id="fastestResponse" class="text-success">-</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card text-center">
                                            <div class="card-body">
                                                <h6 class="card-title">æœ€æ…¢å“åº”</h6>
                                                <h4 id="slowestResponse" class="text-warning">-</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card text-center">
                                            <div class="card-body">
                                                <h6 class="card-title">æµ‹è¯•æ¬¡æ•°</h6>
                                                <h4 id="testCount" class="text-info">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row">
                            <div class="col-12">
                                <h5>å¿«é€Ÿå¯¼èˆª</h5>
                                <a href="/stats" class="btn btn-outline-primary me-2" target="_blank">
                                    <i class="fas fa-chart-bar me-1"></i>ç»Ÿè®¡é¡µé¢
                                </a>
                                <a href="/achievements" class="btn btn-outline-warning me-2" target="_blank">
                                    <i class="fas fa-trophy me-1"></i>æˆå°±é¡µé¢
                                </a>
                                <a href="/achievement-test" class="btn btn-outline-info me-2" target="_blank">
                                    <i class="fas fa-vial me-1"></i>æˆå°±æµ‹è¯•
                                </a>
                                <a href="/profile" class="btn btn-outline-success me-2" target="_blank">
                                    <i class="fas fa-user me-1"></i>ä¸ªäººèµ„æ–™
                                </a>
                                <a href="/" class="btn btn-outline-secondary" target="_blank">
                                    <i class="fas fa-home me-1"></i>é¦–é¡µ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testResults = [];
        
        function logResult(message, type = 'info', duration = null) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'text-success' : 
                              type === 'error' ? 'text-danger' : 
                              type === 'warning' ? 'text-warning' : 'text-info';
            
            const durationText = duration ? ` (${duration}ms)` : '';
            
            resultsDiv.innerHTML += `
                <div class="${colorClass}">
                    <small>[${timestamp}]</small> ${message}${durationText}
                </div>
            `;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            if (duration) {
                testResults.push(duration);
                updateStats();
            }
        }

        async function testPageLoad(url) {
            logResult(`ğŸ”„ å¼€å§‹æµ‹è¯•é¡µé¢: ${url}`, 'info');
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'same-origin'
                });
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                if (response.ok) {
                    logResult(`âœ… é¡µé¢åŠ è½½æˆåŠŸ: ${url}`, 'success', duration);
                } else {
                    logResult(`âŒ é¡µé¢åŠ è½½å¤±è´¥: ${url} (${response.status})`, 'error', duration);
                }
                
            } catch (error) {
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                logResult(`âŒ é¡µé¢åŠ è½½é”™è¯¯: ${url} - ${error.message}`, 'error', duration);
            }
        }

        async function testAPI(url) {
            logResult(`ğŸ”„ å¼€å§‹æµ‹è¯•API: ${url}`, 'info');
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'same-origin',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                if (response.ok) {
                    const data = await response.json();
                    logResult(`âœ… APIå“åº”æˆåŠŸ: ${url}`, 'success', duration);
                } else {
                    logResult(`âŒ APIå“åº”å¤±è´¥: ${url} (${response.status})`, 'error', duration);
                }
                
            } catch (error) {
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                logResult(`âŒ APIè¯·æ±‚é”™è¯¯: ${url} - ${error.message}`, 'error', duration);
            }
        }

        async function runBatchTest() {
            logResult('ğŸš€ å¼€å§‹æ‰¹é‡æ€§èƒ½æµ‹è¯•...', 'warning');
            
            const tests = [
                { type: 'page', url: '/stats' },
                { type: 'page', url: '/achievements' },
                { type: 'page', url: '/profile' },
                { type: 'api', url: '/api/statistics/overview' },
                { type: 'api', url: '/api/user-activity/level' },
                { type: 'api', url: '/api/achievements/current-user' }
            ];
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                logResult(`ğŸ“Š æ‰¹é‡æµ‹è¯• ${i + 1}/${tests.length}: ${test.url}`, 'info');
                
                if (test.type === 'page') {
                    await testPageLoad(test.url);
                } else {
                    await testAPI(test.url);
                }
                
                // çŸ­æš‚å»¶è¿Ÿé¿å…è¿‡å¿«è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            logResult('ğŸ‰ æ‰¹é‡æµ‹è¯•å®Œæˆï¼', 'success');
        }

        function updateStats() {
            if (testResults.length === 0) return;
            
            const avg = Math.round(testResults.reduce((a, b) => a + b, 0) / testResults.length);
            const fastest = Math.min(...testResults);
            const slowest = Math.max(...testResults);
            
            document.getElementById('avgResponseTime').textContent = avg + 'ms';
            document.getElementById('fastestResponse').textContent = fastest + 'ms';
            document.getElementById('slowestResponse').textContent = slowest + 'ms';
            document.getElementById('testCount').textContent = testResults.length;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = 'æµ‹è¯•ç»“æœå·²æ¸…ç©ºï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æ–°çš„æµ‹è¯•...';
            testResults = [];
            updateStats();
            
            document.getElementById('avgResponseTime').textContent = '-';
            document.getElementById('fastestResponse').textContent = '-';
            document.getElementById('slowestResponse').textContent = '-';
            document.getElementById('testCount').textContent = '0';
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            logResult('ğŸ¯ æ€§èƒ½æµ‹è¯•å·¥å…·å·²åŠ è½½', 'success');
            logResult('ğŸ’¡ æç¤ºï¼šä¼˜åŒ–åçš„ç»Ÿè®¡é¡µé¢åº”è¯¥åŠ è½½æ›´å¿«', 'info');
        });
    </script>
</body>
</html>
